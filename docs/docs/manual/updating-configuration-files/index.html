<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<title data-react-helmet="true">Updating configuration files | Release Kubernetes Operator</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://xebialabs.github.io/xl-release-kubernetes-operator/docs/manual/updating-configuration-files"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Updating configuration files | Release Kubernetes Operator"><meta data-react-helmet="true" name="description" content="Prerequisites"><meta data-react-helmet="true" property="og:description" content="Prerequisites"><link data-react-helmet="true" rel="shortcut icon" href="/xl-release-kubernetes-operator/img/digital_ai.svg"><link data-react-helmet="true" rel="canonical" href="https://xebialabs.github.io/xl-release-kubernetes-operator/docs/manual/updating-configuration-files"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-release-kubernetes-operator/docs/manual/updating-configuration-files" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-release-kubernetes-operator/docs/manual/updating-configuration-files" hreflang="x-default"><link rel="stylesheet" href="/xl-release-kubernetes-operator/assets/css/styles.22a8eaea.css">
<link rel="preload" href="/xl-release-kubernetes-operator/assets/js/runtime~main.d89b6f96.js" as="script">
<link rel="preload" href="/xl-release-kubernetes-operator/assets/js/main.67bf4d6f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/xl-release-kubernetes-operator/"><div class="navbar__logo"><img src="/xl-release-kubernetes-operator/img/digital_ai.svg" alt="Release Kubernetes Operator Digital.ai" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/xl-release-kubernetes-operator/img/digital_ai.svg" alt="Release Kubernetes Operator Digital.ai" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Release Kubernetes Operator</b></a><a class="navbar__item navbar__link navbar__link--active" href="/xl-release-kubernetes-operator/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xebialabs/xl-release-kubernetes-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">üåú</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">üåû</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-release-kubernetes-operator/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Manual installation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-release-kubernetes-operator/docs/manual/onprem">On Premises</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/xl-release-kubernetes-operator/docs/manual/updating-configuration-files">Updating configuration files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-release-kubernetes-operator/docs/manual/updating-truststore-files">Adding truststore files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-release-kubernetes-operator/docs/manual/setting-up-custom-namespace">Setting up custom namespace</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Updating configuration files</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="prerequisites">Prerequisites<a aria-hidden="true" class="hash-link" href="#prerequisites" title="Direct link to heading">‚Äã</a></h2><ul><li>Linux environment</li><li>The kubectl command-line tool</li><li>The yq command-line tool (<a href="https://github.com/mikefarah/yq/releases" target="_blank" rel="noopener noreferrer">Use the latest binary</a>)</li><li>Access to a Kubernetes cluster with installed Release</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="update-xl-releaseconf-for-release-xl-releaseconf">Update xl-release.conf for Release xl-release.conf<a aria-hidden="true" class="hash-link" href="#update-xl-releaseconf-for-release-xl-releaseconf" title="Direct link to heading">‚Äã</a></h2><p>Get current xl-release.conf file from the release server node:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> dai-xlr-digitalai-release-0:/opt/xebialabs/xl-release-server/conf/xl-release.conf ./xl-release.conf</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Create following template file to append to it the retrieved <code>./xl-release.conf</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: xl-release-conf-config-map</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    app: digitalai-release</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  xl-release.conf: |&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> config-patch-xl-release-conf.yaml.template</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Merge the files:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> config-patch-xl-release-conf.yaml.template </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> config-patch-xl-release-conf.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -e </span><span class="token string" style="color:#e3116c">&#x27;s/^/     /&#x27;</span><span class="token plain"> xl-release.conf </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> config-patch-xl-release-conf.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Change the config in the <code>config-patch-xl-release-conf.yaml</code>.</p><p>Create the config map with <code>config-patch-xl-release-conf.yaml</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl create -f config-patch-xl-release-conf.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Get all statefulsets (release statefulset will be suffixed with <code>-release</code>):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl get sts -o name</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If you create additional configuration like in following lines note that in during next upgrade process you need create custom image like described
<a href="#upgrade-process-if-you-have-updated-files-with-config-maps">in the section</a></p></div></div><p>Change the statefulset for the release server by adding volume mounts and volumes:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl get statefulset.apps/dai-xlr-digitalai-release -o yaml </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> yq </span><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.spec.template.spec.containers[0].volumeMounts += {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;mountPath&quot;: &quot;/opt/xebialabs/xl-release-server/conf/xl-release.conf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;name&quot;: &quot;xl-release-conf-volume&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;subPath&quot;: &quot;xl-release.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      }&#x27;</span><span class="token plain"> - </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> yq </span><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.spec.template.spec.volumes += [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;name&quot;: &quot;xl-release-conf-volume&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;configMap&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;name&quot;: &quot;xl-release-conf-config-map&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      }]&#x27;</span><span class="token plain"> - </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl replace -f -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Restart Release servers (all release server pods):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl delete pod dai-xlr-digitalai-release-0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="update-configuration-file-generic-example-for-release">Update configuration file generic example for Release<a aria-hidden="true" class="hash-link" href="#update-configuration-file-generic-example-for-release" title="Direct link to heading">‚Äã</a></h2><p>You can use following way to update any configuration file on the Release <code>conf</code> directory that has template in the <code>default-conf</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In the following example, we are changing the template file from the <code>default-conf</code>, not the direct configuration file from the <code>conf</code>.
The reason for that is in that way we are able to change environment variables in the container via release CR. Those variables are used during the startup of the pod.
to evaluate template placeholders to the target file in the <code>conf</code> folder.</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The files in the directory <code>conf</code> need to be updated on all replicated server nodes.</p></div></div><p>Get info to list release pod names and statefulsets:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -o name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get sts -o name</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Setup environment vals:</p><ul><li>change <code>CONFIG_FILE</code> variable and <code>PATH_TO_CONFIG_FILE</code> to :</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PRODUCT</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POD_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dai-xlr-digitalai-release-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">CONFIG_FILE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">xl-release.conf.template</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">CONFIG_FILE_DASH</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${CONFIG_FILE</span><span class="token variable operator" style="color:#393A34">/</span><span class="token variable operator" style="color:#393A34">/</span><span class="token variable" style="color:#36acaa">.</span><span class="token variable operator" style="color:#393A34">/</span><span class="token variable" style="color:#36acaa">-}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PATH_TO_CONFIG_FILE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/opt/xebialabs/xl-</span><span class="token variable" style="color:#36acaa">$PRODUCT</span><span class="token plain">-server/default-conf/</span><span class="token variable" style="color:#36acaa">$CONFIG_FILE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">STATEFUL_SET_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">statefulset.apps/dai-xlr-digitalai-release</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Run set of commands:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$POD_NAME</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$PATH_TO_CONFIG_FILE</span><span class="token plain"> ./</span><span class="token variable" style="color:#36acaa">$CONFIG_FILE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: </span><span class="token string variable" style="color:#36acaa">$CONFIG_FILE_DASH</span><span class="token string" style="color:#e3116c">-config-map</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    app: digitalai-</span><span class="token string variable" style="color:#36acaa">$PRODUCT</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  </span><span class="token string variable" style="color:#36acaa">$CONFIG_FILE</span><span class="token string" style="color:#e3116c">: |&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> config-patch-</span><span class="token variable" style="color:#36acaa">${CONFIG_FILE}</span><span class="token plain">.yaml.template</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> config-patch-</span><span class="token variable" style="color:#36acaa">${CONFIG_FILE}</span><span class="token plain">.yaml.template </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> config-patch-</span><span class="token variable" style="color:#36acaa">${CONFIG_FILE}</span><span class="token plain">.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -e </span><span class="token string" style="color:#e3116c">&#x27;s/^/     /&#x27;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$CONFIG_FILE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> config-patch-</span><span class="token variable" style="color:#36acaa">${CONFIG_FILE}</span><span class="token plain">.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Edit the YAML file and add your custom changes to it: <code>config-patch-${CONFIG_FILE}.yaml</code></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If you create additional configuration like in following lines note that in during next upgrade process you need create custom image like described
<a href="#upgrade-process-if-you-have-updated-files-with-config-maps">in the section</a></p></div></div><p>Create config map on cluster and use it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f config-patch-</span><span class="token variable" style="color:#36acaa">${CONFIG_FILE}</span><span class="token plain">.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get </span><span class="token variable" style="color:#36acaa">$STATEFUL_SET_NAME</span><span class="token plain"> -o yaml </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> yq </span><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.spec.template.spec.containers[0].volumeMounts += {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">mountPath</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">: </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string variable" style="color:#36acaa">$PATH_TO_CONFIG_FILE</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">name</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">: </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string variable" style="color:#36acaa">$CONFIG_FILE_DASH</span><span class="token string" style="color:#e3116c">-volume</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">subPath</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">: </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string variable" style="color:#36acaa">$CONFIG_FILE</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      }&quot;</span><span class="token plain"> - </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> yq </span><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.spec.template.spec.volumes += [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">name</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">: </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string variable" style="color:#36acaa">$CONFIG_FILE_DASH</span><span class="token string" style="color:#e3116c">-volume</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">configMap</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">name</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">: </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string variable" style="color:#36acaa">$CONFIG_FILE_DASH</span><span class="token string" style="color:#e3116c">-config-map</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      }]&quot;</span><span class="token plain"> - </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl replace -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pod </span><span class="token variable" style="color:#36acaa">$POD_NAME</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="upgrade-process-if-you-have-updated-files-with-config-maps">Upgrade process if you have updated files with config maps<a aria-hidden="true" class="hash-link" href="#upgrade-process-if-you-have-updated-files-with-config-maps" title="Direct link to heading">‚Äã</a></h3><p>To preserve configuration changes after upgrades, you will need to build custom images of the operator with all custom changes in
the statefulsets:</p><ol><li>Checkout correct branch for the Release helm chart with the target version branch of the operator from here: <a href="https://github.com/xebialabs/xl-release-kubernetes-helm-chart" target="_blank" rel="noopener noreferrer">xl-release-kubernetes-helm-chart</a></li><li>Build the operator with the provided script in the root of the repo: <code>./build_operator.sh</code></li><li>Release the operator to the image repository according to the script&#x27;s guide</li><li>Use the newly created image as the answer during <code>xl op --upgrade</code> execution:<ul><li><code>Operator image to use (OperatorImageRelease)</code></li></ul></li><li>After the upgrade, if the upgrade changes the configuration files, transfer the changes to the config-map so the changes could be preserved.</li></ol><h2 class="anchor anchorWithStickyNavbar_31ik" id="update-configuration-file-for-rabbitmq">Update configuration file for RabbitMQ<a aria-hidden="true" class="hash-link" href="#update-configuration-file-for-rabbitmq" title="Direct link to heading">‚Äã</a></h2><p>To change configuration of the RabbitMQ use available parameters on the
<a href="https://github.com/bitnami/charts/tree/master/bitnami/rabbitmq#parameters" target="_blank" rel="noopener noreferrer">RabbitMQ packaged by Bitnami</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="update-configuration-file-for-postgresql">Update configuration file for PostgreSql<a aria-hidden="true" class="hash-link" href="#update-configuration-file-for-postgresql" title="Direct link to heading">‚Äã</a></h2><p>To change configuration of the PostgreSql use available parameters on the
<a href="https://github.com/bitnami/charts/tree/master/bitnami/postgresql#parameters" target="_blank" rel="noopener noreferrer">PostgreSQL packaged by Bitnami</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="upgrade-process-if-you-have-updated-the-cr-values">Upgrade process if you have updated the CR values<a aria-hidden="true" class="hash-link" href="#upgrade-process-if-you-have-updated-the-cr-values" title="Direct link to heading">‚Äã</a></h2><p>To preserve changed values in the CR use the following:</p><ol><li>Download operator zip version from the <a href="https://dist.xebialabs.com/customer/operator/release/" target="_blank" rel="noopener noreferrer">release operator zip</a>
with specific provider and version that you will install</li><li>Run <code>xl op --upgrade</code> with answers:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Do you want to use a custom operator zip file for Release? (UseOperatorZipRelease): Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Release operator zip to use (absolute path or URL to the zip) (OperatorZipRelease): [Path to the zip file that you downloaded]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Edit list of custom resource keys that will migrate to the new Release CR (PreserveCrValuesRelease): [Check comment below]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Add all paths where you updated CR values from the original value.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/xl-release-kubernetes-operator/docs/manual/onprem"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ <!-- -->On Premises</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/xl-release-kubernetes-operator/docs/manual/updating-truststore-files"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Adding truststore files<!-- --> ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#update-xl-releaseconf-for-release-xl-releaseconf" class="table-of-contents__link toc-highlight">Update xl-release.conf for Release xl-release.conf</a></li><li><a href="#update-configuration-file-generic-example-for-release" class="table-of-contents__link toc-highlight">Update configuration file generic example for Release</a><ul><li><a href="#upgrade-process-if-you-have-updated-files-with-config-maps" class="table-of-contents__link toc-highlight">Upgrade process if you have updated files with config maps</a></li></ul></li><li><a href="#update-configuration-file-for-rabbitmq" class="table-of-contents__link toc-highlight">Update configuration file for RabbitMQ</a></li><li><a href="#update-configuration-file-for-postgresql" class="table-of-contents__link toc-highlight">Update configuration file for PostgreSql</a></li><li><a href="#upgrade-process-if-you-have-updated-the-cr-values" class="table-of-contents__link toc-highlight">Upgrade process if you have updated the CR values</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/xl-release-kubernetes-operator/docs/intro">Tutorial</a></li><li class="footer__item"><a href="https://github.com/xebialabs/xl-release-kubernetes-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Release Kubernetes Operator Digital.ai</div></div></div></footer></div>
<script src="/xl-release-kubernetes-operator/assets/js/runtime~main.d89b6f96.js"></script>
<script src="/xl-release-kubernetes-operator/assets/js/main.67bf4d6f.js"></script>
</body>
</html>